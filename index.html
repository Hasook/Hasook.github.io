<!DOCTYPE html>
<html>
<head>
    <title>实时记录句子</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <h1>实时记录句子</h1>
    <input type="text" id="sentenceInput" placeholder="输入句子">
    <button onclick="saveSentence()">保存</button>
    <ul id="sentenceList"></ul>

    <script>
        // GitHub相关配置
        const username = 'hasook';
        const repo = 'Hasook.github.io';
        const branch = 'main';
        const path = 'sentences.txt';
        const token = 'hh2002512'; // 需要有repo权限

        // 获取已保存的句子
        $(document).ready(function() {
            $.ajax({
                url: `https://api.github.com/repos/${username}/${repo}/contents/${path}?ref=${branch}`,
                headers: {
                    'Authorization': `token ${token}`
                },
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    const content = atob(data.content);
                    const sentences = content.split('\n');
                    sentences.forEach(function(sentence) {
                        if (sentence !== '') {
                            $('#sentenceList').append(`<li>${sentence}</li>`);
                        }
                    });
                }
            });
        });

        // 保存句子到GitHub
        function saveSentence() {
            const sentence = $('#sentenceInput').val();
            if (sentence !== '') {
                $.ajax({
                    url: `https://api.github.com/repos/${username}/${repo}/contents/${path}`,
                    headers: {
                        'Authorization': `token ${token}`
                    },
                    method: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        const content = atob(data.content);
                        const sentences = content.split('\n');
                        sentences.push(sentence);
                        const updatedContent = sentences.join('\n');
                        const encodedContent = btoa(updatedContent);
                        const sha = data.sha;

                        $.ajax({
                            url: `https://api.github.com/repos/${username}/${repo}/contents/${path}`,
                            headers: {
                                'Authorization': `token ${token}`
                            },
                            method: 'PUT',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                message: 'Add sentence',
                                content: encodedContent,
                                sha: sha,
                                branch: branch
                            }),
                            success: function() {
                                $('#sentenceList').append(`<li>${sentence}</li>`);
                                $('#sentenceInput').val('');
                            }
                        });
                    }
                });
            }
        }
    </script>
</body>
</html>
